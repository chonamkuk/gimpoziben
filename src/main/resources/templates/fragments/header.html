<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">


<header th:fragment="headerFragment" class="page-topbar" id="header">
    <script type="text/javascript">
        let modalStack = [];
        $(document).ready(function() {
            $('#alertModal').modal({
                onOpenEnd: function(e){
                    let modalId = $(this).attr('id');
                    if(location.href.split('#').pop() != modalId) {
                        window.history.pushState({}, '', location.href + '#' + $(this).attr('id'));
                    }
                    modalStack.push(modalId);
                },
                onCloseStart: function(e){
                    if(location.href.split('#').pop() == $(this).attr('id')) {
                        window.history.back();
                    }
                },
                onCloseEnd: function(e) {
                    $(this).find('h4').text('');
                    $(this).find('p').text('');
                    modalStack.pop();
                }
            });

            $('#imageModal').modal({
                onOpenStart: function(e) {
                    let modalId = $(this).attr('id');
                    if(location.href.split('#').pop() != modalId) {
                        window.history.pushState({}, '', location.href + '#' + $(this).attr('id'));
                    }
                    modalStack.push(modalId);

                    // 이미지 업로드 로직
                    let imgTags = $('.slide-img');
                    let selectedImg = $('.slide-img:hover');
                    let imgIndex = imgTags.index(selectedImg);
                    let imgSrc = selectedImg.css('background-image');

                    // 클릭한 이미지
                    if(typeof(imgSrc) != "undefined") {
                        imgSrc = imgSrc.replace('url(','').replace(')','').replace(/\"/gi, "");
                        $('.modal-slide').eq(0).css({'background-image' : 'url('+ imgSrc +')'});
                    }
                    $('#imageModal').find('#numbertext').text((imgIndex+1) + '/' + imgTags.length);

                    // 이미지 슬라이드효과
                    $('#imageModal').find('.prev').on('click', function(){
                        if(imgIndex <= 0) { // 맨처음 이미지일 때
                            imgIndex = imgTags.length-1;
                        } else {
                            imgIndex--;
                        }
                        imgSrc = imgTags.eq(imgIndex).css('background-image');
                        imgSrc = imgSrc.replace('url(','').replace(')','').replace(/\"/gi, "");
                        $('.modal-slide').eq(0).css({'background-image' : 'url('+ imgSrc +')'});
                        $('#imageModal').find('#numbertext').text((imgIndex+1) + '/' + imgTags.length);
                    });
                    $('#imageModal').find('.next').on('click', function(){
                        if(imgIndex >= imgTags.length-1) { // 마지막 이미지일 때
                            imgIndex = 0;
                        } else {
                            imgIndex++;
                        }
                        imgSrc = imgTags.eq(imgIndex).css('background-image');
                        imgSrc = imgSrc.replace('url(','').replace(')','').replace(/\"/gi, "");
                        $('.modal-slide').eq(0).css({'background-image' : 'url('+ imgSrc +')'});
                        $('#imageModal').find('#numbertext').text((imgIndex+1) + '/' + imgTags.length);
                    });
                },
                onCloseStart: function(e){
                    if(location.href.split('#').pop() == $(this).attr('id')) {
                        window.history.back();
                    }
                },
                onCloseEnd: function(e) {
                    $(this).find('#numbertext').text('');
                    $(this).find('.prev').off('click');
                    $(this).find('.next').off('click');
                    modalStack.pop();
                }
            });

            $('#confirmModal').modal({
                onOpenEnd: function(e){
                    let modalId = $(this).attr('id');
                    if(location.href.split('#').pop() != modalId) {
                        window.history.pushState({}, '', location.href + '#' + $(this).attr('id'));
                    }
                    modalStack.push(modalId);
                },
                onCloseStart: function(e){
                    if(location.href.split('#').pop() == $(this).attr('id')) {
                        window.history.back();
                    }
                },
                onCloseEnd: function(e) {
                    $(this).find('h4').text('');
                    $(this).find('p').text('');
                    $(this).find('.modal-close').off('click');
                    modalStack.pop();
                }
            });

            window.onpopstate = history.onpushstate = function(e) {
                console.info('뒤로가기 감지 : ' + e);
                if(modalStack.length > 0) {
                    let currentModal = modalStack[modalStack.length-1];
                    M.Modal.getInstance($('#'+currentModal)).close();
                }
            }
        });
    </script>

    <div class="navbar navbar-fixed">
        <nav class="navbar-main navbar-color nav-collapsible sideNav-lock navbar-dark gradient-45deg-light-blue-cyan">
            <div class="nav-wrapper">
                <ul class="left">
                    <li>
                        <h1 class="logo-wrapper">
                            <a class="brand-logo darken-1" href="#1">
                                <img src="/static/image/logo/logo-left-top.png">
                                <span class="logo-text hide-on-med-and-down"></span>
                            </a>
                        </h1>
                    </li>
                </ul>
                <ul class="navbar-list right">
                    <li>
                        <a class="waves-effect waves-block waves-light notification-button" href="javascript:void(0);" data-target="notifications-dropdown">
                            <i class="material-icons">shopping_cart<small class="notification-badge orange accent-3">5</small></i>
                        </a>
                    </li>
                    <li>
                        <a class="waves-effect waves-block waves-light profile-button" href="javascript:void(0);" data-target="profile-dropdown">
                            <i class="material-icons">account_circle</i>
                        </a>
                    </li>
                </ul>
                <!-- notifications-dropdown-->
                <ul class="dropdown-content" id="notifications-dropdown">
                    <li>
                        <h6>NOTIFICATIONS<span class="new badge">5</span></h6>
                    </li>
                    <li class="divider"></li>
                    <li><a class="black-text" href="#!"><span class="material-icons icon-bg-circle cyan small">add_shopping_cart</span> A new order has been placed!</a>
                        <time class="media-meta grey-text text-darken-2" datetime="2015-06-12T20:50:48+08:00">2 hours ago</time>
                    </li>
                </ul>
                <!-- profile-dropdown-->
                <ul class="dropdown-content" id="profile-dropdown">
                    <li><a class="grey-text text-darken-1" href="#"><i class="material-icons">face</i> Profile</a></li>
                    <li><a class="grey-text text-darken-1" href="#"><i class="material-icons">settings</i> Settings</a></li>
                    <li><a class="grey-text text-darken-1" href="#"><i class="material-icons">live_help</i> Help</a></li>
                    <li class="divider"></li>
                    <li><a class="grey-text text-darken-1" href="#"><i class="material-icons">lock_outline</i> Lock</a></li>
                    <li><a class="grey-text text-darken-1" href="#"><i class="material-icons">keyboard_tab</i> Logout</a></li>
                </ul>
            </div>
        </nav>
        <!-- BEGIN: Horizontal nav start-->
        <nav class="white hide-on-med-and-down" id="horizontal-nav">
            <div class="nav-wrapper">
                <ul class="left hide-on-med-and-down" id="ul-horizontal-nav" data-menu="menu-navigation">
                    <li>
                        <a class="dropdown-menu" href="#" data-target="formsTables">
                            <i class="material-icons">business</i>
                            <span><span class="dropdown-title" data-i18n="Menu levels">회사소개</span><i class="material-icons right">keyboard_arrow_down</i></span>
                        </a>
                        <ul class="dropdown-content dropdown-horizontal-list" id="formsTables">
                            <li data-menu=""><a href="#"><span data-i18n="Second level 1">매장소개</span></a>
                            </li>
                            <li data-menu=""><a href="#"><span data-i18n="Second level 2">연혁</span></a>
                            </li>
                            <li data-menu=""><a href="#"><span data-i18n="Second level 4">회사위치</span></a>
                            </li>
                        </ul>
                    </li>
                    <li class="">
                        <a class="dropdown-menu" href="#" data-target="formsTables2">
                            <i class="material-icons">store</i>
                            <span><span class="dropdown-title" data-i18n="Menu levels">제품소개</span><i class="material-icons right">keyboard_arrow_down</i></span>
                        </a>
                        <ul class="dropdown-content dropdown-horizontal-list" id="formsTables2">
                            <li class="dropdown dropdown-submenu" data-menu="dropdown-submenu">
                                <a class="dropdownSub-menu" href="#" data-target="thirdDropdown">
                                    <span data-i18n="Second level 3">제품리스트</span><i class="material-icons right">chevron_right</i>
                                </a>
                                <ul class="dropdown-content dropdown-horizontal-list" id="thirdDropdown">
                                    <li data-menu=""><a href="#"><span data-i18n="Child 1">전체</span></a>
                                    </li>
                                    <li data-menu=""><a href="#"><span data-i18n="Child 2">상의</span></a>
                                    </li>
                                    <li data-menu=""><a href="#"><span data-i18n="Child 3">하의</span></a>
                                    </li>
                                </ul>
                            </li>
                            <li data-menu=""><a href="#"><span data-i18n="Second level 2">주문현황</span></a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a class="dropdown-menu" href="#" data-target="formsTables3">
                            <i class="material-icons">support_agent</i>
                            <span><span class="dropdown-title" data-i18n="Menu levels">고객센터</span><i class="material-icons right">keyboard_arrow_down</i></span>
                        </a>
                        <ul class="dropdown-content dropdown-horizontal-list" id="formsTables3">
                            <li data-menu=""><a href="#"><span data-i18n="Second level 1">공지사항</span></a>
                            </li>
                            <li data-menu=""><a href="#"><span data-i18n="Second level 2">FAQ</span></a>
                            </li>
                            <li data-menu=""><a href="#"><span data-i18n="Second level3">Q&A</span></a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <!-- END: Horizontal nav start-->
            </div>
        </nav>
    </div>

    <!-- BEGIN: SideNav-->
    <aside class="sidenav-main nav-expanded nav-lock nav-collapsible sidenav-fixed hide-on-large-only">
        <div class="brand-sidebar sidenav-light"></div>
        <ul class="sidenav sidenav-collapsible leftside-navigation collapsible sidenav-fixed hide-on-large-only menu-shadow" id="slide-out" data-menu="menu-navigation" data-collapsible="menu-accordion">
<!--            <li class="navigation-header"><a class="navigation-header-text">Misc </a><i class="navigation-header-icon material-icons">more_horiz</i>-->
<!--            </li>-->
            <li class="bold">
                <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">business</i><span class="menu-title" data-i18n="Menu levels">회사소개</span></a>
                <div class="collapsible-body">
                    <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                        <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Second level">매장소개</span></a>
                        </li>
                        <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Second level">연혁</span></a>
                        </li>
                        <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Second level">회사위치</span></a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="bold">
                <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">store</i><span class="menu-title" data-i18n="Menu levels">제품소개</span></a>
                <div class="collapsible-body">
                    <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                        <li><a class="collapsible-header waves-effect waves-cyan" href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Second level child">제품리스트</span></a>
                            <div class="collapsible-body">
                                <ul class="collapsible" data-collapsible="accordion">
                                    <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Third level">전체</span></a>
                                    </li>
                                    <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Third level">상의</span></a>
                                    </li>
                                    <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Third level">하의</span></a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Second level">주문현황</span></a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="bold">
                <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">support_agent</i><span class="menu-title" data-i18n="Menu levels">고객센터</span></a>
                <div class="collapsible-body">
                    <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                        <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Second level">공지사항</span></a>
                        </li>
                        <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Second level">FAQ</span></a>
                        </li>
                        <li><a href="#"><i class="material-icons">radio_button_unchecked</i><span data-i18n="Second level">Q&A</span></a>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
        <div class="navigation-background"></div><a class="sidenav-trigger btn-floating btn-medium waves-effect waves-light hide-on-large-only" href="#" data-target="slide-out"><i class="material-icons">menu</i></a>
    </aside>
    <!-- END: SideNav-->

    <!-- alert 모달 -->
    <div id="alertModal" class="modal">
        <div class="modal-content">
            <h4></h4>
            <p></p>
        </div>
        <div class="modal-footer">
            <a class="modal-close waves-effect waves-green btn-flat">확인</a>
        </div>
    </div>

    <!-- 이미지뷰 모달 -->
    <div id="imageModal" class="modal" style="width: 90%;">
        <div class="img-container">
            <div class="modal-slide" style="margin-bottom: 0px; background-image: url('/static/image/bike-sunset.jpg'); background-size: contain;">
                <div id="numbertext" class="numbertext"></div>
                <i class="material-icons modal-close" style="float: right;">close</i>
            </div>
            <a class="prev">❮</a>
            <a class="next">❯</a>
        </div>
    </div>

    <!-- confirm 모달-->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h4></h4>
            <p></p>
        </div>
        <div class="modal-footer">
            <a class="modal-close waves-effect waves-green btn-flat cancel">취소</a>
            <a class="modal-close waves-effect waves-green btn-flat confirm">확인</a>
        </div>
    </div>
</header>
</html>